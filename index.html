<!DOCTYPE html>

<html lang="en">

<head>

<title>MACHINE LEARNING WEB PROJECT</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="./src/main/resources/public/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="./src/main/resources/public/main.css">
<script src="./src/main/resources/public/jquery-3.5.1.min.js"></script>
<script src="./src/main/resources/public/bootstrap/js/bootstrap.min.js"></script>
<script src="./src/main/resources/public/main.js"></script>

</head>

<script language="JavaScript">
// Sending a receiving data in JSON format using GET method
//  
// api url 
const url_upload = "http://localhost:4567/upload";
const url_result = "http://localhost:4567/result";
const url_clean = "http://localhost:4567/clean";

function uploadfile() {
	var form = document.getElementById('myForm'); // give the form an ID
	var xhr  = new XMLHttpRequest();              // create XMLHttpRequest
	var data = new FormData(form);                // create formData object


	xhr.onload = function() {
	    console.log(this.responseText); // whatever the server returns
	}

	xhr.open("post", url_upload);      // open connection
	xhr.send(data); 
	document.getElementById("is_uploaded").innerHTML = "A JSON file has been uploaded"
	//document.getElementById("display").innerHTML = xhr.responseText;

}

function httpGet()
{
    var xmlHttp = new XMLHttpRequest();
	xmlHttp.responseType = 'text';
    xmlHttp.open( "GET", url_result); // false for synchronous request
	xmlHttp.onreadystatechange = function() {
	    if(xmlHttp.readyState == 4 && xmlHttp.status == 200) {
		// we have a response and this is where we do something with it
		result = xmlHttp.responseText;
	    }
	}

    xmlHttp.send();
	//handles Json and gets the last value of the initial json result
	const json_res = JSON.parse(result);
	var lastKey = Object.keys(json_res).sort().reverse()[0];
	var lastValue = json_res[lastKey];
	var text_to_print = "";
	for(var key in lastValue){
		    if(lastValue.hasOwnProperty(key)){
			value = lastValue[key];
			text_to_print = text_to_print + key + " : " + value + "<br>"
		    }
		}
    //document.getElementById("display").innerHTML = JSON.stringify(lastValue);
	document.getElementById("display").innerHTML = text_to_print;
}

function getClean()
{
    var xmlHttp = new XMLHttpRequest();
xmlHttp.responseType = 'text';
    xmlHttp.open( "GET", url_clean); // false for synchronous request
    xmlHttp.onreadystatechange = function() {
	    if(xmlHttp.readyState == 4 && xmlHttp.status == 200) {
		// we have a response and this is where we do something with it
		result = xmlHttp.responseText;
	    }
	}

    xmlHttp.send();
	document.getElementById("display").innerHTML = "";
	document.getElementById("is_uploaded").innerHTML = "No file uploaded";
}

</script>

<body>

	<nav class="navbar navbar-expand-md">
		<a class="navbar-brand" href="#">Logo</a>
		<div class="collapse navbar-collapse" id="main-navigation">
			<ul class="navbar-nav">
				<li class="nav-item"><a class="nav-link" href="./index.html">Home</a>
				</li>
				<li class="nav-item"><a class="nav-link"
					href="mailto:sidgroupe01@ensai.fr">Contact</a></li>
			</ul>
		</div>
	</nav>

	<header class="page-header header container-fluid">
		<div class="overlay"><img src="logo_ensai.png" alt="Ensai logo" style="width:12%;height:12%;"></div>
		<div class="description">
			
			<h1>Machine learning web application project</h1>
			<p>This is a ML tool which enables to simulate decision tree algorithms
				thanks to different different languages (Python, R, Julia) and their ML packages. 
				The backend server runs on Java code which in turn uses Python, R and Julia environments.</p>
			<p>You can try several parameters by providing a JSON file below :</p>
					<font color="white">
					<form ID='myForm' enctype='multipart/form-data' onsubmit="return false">
						<input type='file' name='uploaded_file' accept='.json'>
						<button onclick="getClean(); uploadfile();">Upload file</button>
					</form>
					<p><span id="is_uploaded"></span></p>
					</font>
					<p><br><button class="btn btn-outline-secondary btn-lg" data-toggle="modal"
				data-target="#mlform" class="btn btn-primary" onclick="httpGet();">Open result</button>
					</p>
		</div>

	</header>
	<!--
	<div class="container features">
		<div class="row">
			<div class="col-lg-4 col-md-4 col-sm-6">
				<h3 class="feature-title">First Result</h3>
				<p>bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
					bla bla bla bla bla bla bla bla bla bla bla bla blabla bla bla bla
					bla bla bla.</p>
			</div>
			<div class="col-lg-4 col-md-4 col-sm-6">
				<h3 class="feature-title">Second result</h3>
				<p>bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
					bla bla bla bla bla bla bla bla bla bla bla bla blabla bla bla bla
					bla bla bla.</p>
			</div>
			<div class="col-lg-4 col-md-4 col-sm-6">
				<h3 class="feature-title">Third result</h3>
				<p>bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
					bla bla bla bla bla bla bla bla bla bla bla bla blabla bla bla bla
					bla bla bla.</p>
			</div>
		</div>
	</div>
	-->

	<footer class="page-footer">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-md-8 col-sm-12">
					<h6 class="text-uppercase font-weight-bold">Group members</h6>
					<p>Antoine Boulinguez</p>
					<p>Alexis Gassmann</p>
					<p>Alex Georget</p>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-12">
					<h6 class="text-uppercase font-weight-bold">Contact</h6>
					<p>
						ENSAI, CAMPUS DE KER-LANN <br />51 Rue Blaise Pascal <br />BP
						37203 – 35172 BRUZ cedex <br />+33 (0)2 99 05 32 32 <br />sid@ensai.fr
					</p>
				</div>
			</div>
			<div class="footer-copyright text-center">© 2021 Copyright:
				sid.ensai.fr</div>
	</footer>



	<div class="modal fade" id="mlform">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header"
					style="color: white; background-image: url(./src/main/resources/public/images/bg-06.jpg);">
					<h4 class="modal-title">Result of the analysis:</h4>
					<button type="button" class="close" data-dismiss="modal">
						<span>&times;</span>
					</button>
				</div>
				<div class="modal-body row">
					
					<p><button onclick="httpGet();">Print result</button>
					<br><span id="display"></span>
					<br><button onclick="getClean();">Clean</button>
					</p>
				</div>
			</div>
		</div>
</body>

</html>
